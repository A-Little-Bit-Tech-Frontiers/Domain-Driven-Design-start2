# 4. 리포지터리와 모델 구현

### 애그리거트 엔티티 매핑 고려사항

- 애그리거트에서 루트 엔티티를 제외한 나머지 구성요소는 대부분 값 객체이다.
- **루트 엔티티를 제외한 같은 애그리거트 소속 다른 엔티티가 존재할 경우**
    - 변경 주체가 루트 엔티티이고 각자의 변경이 서로 영향을 끼치지 않는 경우, 다른 엔티티는 값 객체일 가능성이 높다.
    - 루트 이외에 다른 엔티티가 독자적으로 움직이지는 않는지 체크하기

### **DIP 를 고려한 리포지터리 구현**

- Spring Data JPA 를 사용한 리포지터리, 도메인 모델은 영속성 관리 기술에 강하게 의존적이다. 이를 순수한 도메인 ↔ 인프라 구조로 계층을 구분하려면, 상속을 받지 않는 인터페이스를 중심으로 의존하도록 해야 한다.
- 저자는 영속성 관리 계층 구현을 위해 JPA 를 사용했지만, 다른 구현 기술로 변경한 경험이 없기 때문에 DIP 를 철저하게 적용하지 않고 JPA 의존적인 도메인 구현 방식을 깊게 소개했다.
- 하지만, **JPA 일체형 도메인** 구현은 **순수 도메인 모델 with 엔티티** 구현보다 알아야 할 내용이 많고 구현이 복잡하여 관리에 오히려 어려움이 많을 수도 있다.