# 💡 6.1 표현 영역과 응용 영역

![image](https://github.com/user-attachments/assets/8bfdeda4-fc4f-49ea-a4eb-1cfa4442b7d7)

### 표현 영역

- 사용자의 요청을 해석한다.
- 사용자가 실행하고 싶은 기능을 판별하고, 그 기능을 제공하는 응용 서비스를 실행한다.
- 사용자에게 알맞은 형식으로 제공 (HTML, JSON)

### 응용 영역

- 실제 사용자가 원하는 기능을 제공
- 응용 서비스는 표현 영역에 의존하지 않는다!
  - REST API를 사용하는지, TCP 소켓을 사용하는지 알 필요가 없다.
  - 기능 실행에 필요한 입력값을 받고, 실행 결과만 리턴하면 된다.
 
# 💡 6.2 응용 서비스의 역할

- 응용 서비스는 도메인 영역과 표현 영역을 이어주는 창구이다.
- ❗ 만약, 응용 서비스가 복잡하다면 응용 서비스에서 도메인 로직의 일부를 구현하고 있을 가능성이 높다.
  - 응용 서비스가 도메인 로직을 일부 구현하면 코드 중복, 로직 분산 등 코드 품질에 안좋은 영향을 줄 수 있다.
- 응용 서비스는 트랜잭션 처리도 담당한다.

### 6.2.1 도메인 로직 넣지 않기

- 도메인 로직은 도메인 영역에 위치하고 응용 서비스는 도메인 로직을 구현하지 않는다.

![image](https://github.com/user-attachments/assets/bb927e96-6816-4927-8961-13e6502c573f)

- 만약 위 코드와 같이 응용 서비스에서 도메인 로직을 구현하게 되면 코드 품질에 문제가 발생한다.
  - 첫 번째 문제는, 코드의 응집성이 떨어진다. -> 도메인 로직을 파악하기 위해 여러 영역을 분석해야 한다는 것을 의미한다.
  - 두 번째 문제는, 코드 중복이 발생할 수 있다. 여러 응용 서비스에서 동일한 도메인 로직을 구현할 가능성이 높아진다. 이럴 경우 추후 유지보수가 매우 어려워지게 된다. (도메인 로직이 변경되면 관련 코드를 모두 찾아 수정해야 한다.)
- 소프트웨어가 가져야 할 중요한 경쟁 요소 중 하나는 변경 용이성인데, 변경이 어렵다는 것은 그만큼 소프트웨어의 가치가 떨어진다는 것을 의미한다.
- 소프트웨어의 가치를 높이려면 도메인 로직을 도메인 영역에 모아서 코드 중복을 줄이고 응집도를 높여야 한다.

# 💡 6.3 응용 서비스의 구현

### 6.3.1 응용 서비스의 크기

- 응용 서비스의 크기는 어느정도가 적당할까?에 대한 문제
- 대표적으로 2가지 케이스가 있다.
  - 한 응용 서비스 클래스에 도메인의 모든 기능 구현하기
  - 구분되는 기능별로 응용 서비스 클래스를 따로 구현하기 (필자의 추천)
- 코드 크기가 커지면 연관성이 적은 코드가 한 클래스에 함께 위치할 가능성이 높아지게 되는데 결과적으로 관련 없는 코드가 뒤섞여 코드를 이해하는 데 방해가 된다.
  - e.g. 클래스의 필드가 어떤 메서드에서 쓰이는지 파악이 어렵다.
- 한 클래스에 코드를 모아두게 되면 분리해야 할 상황에도 기존의 클래스에 억지로 끼워넣는 문제가 발생할 수 있다. -> 이것은 코드를 점점 얽히게 만들어 코드 품질을 저하시키게 된다.
- 따라서, 구분되는 기능별로 서비스 클래스를 구현하는 방식으로, 한 응용 서비스 클래스에서 한 개 내지 2~3개의 기능을 구현하는 방식을 추천한다.
- 각 기능마다 동일한 로직을 구현할 경우 여러 클래스에 중복해서 동일한 코드를 구현할 가능성이 있다. 이 경우 별도 클래스(~Helper)에 로직을 구현해서 코드가 중복되는 것을 방지할 수있다.

### 6.3.2 응용 서비스의 인터페이스와 클래스

- 응용 서비스는 반드시 인터페이스를 가져야 하는가?
- TDD 중 표현 영역부터 개발할 경우 응용 서비스의 인터페이스를 먼저 정의하는 것은 좋은 습관이다. (구현체가 필요하지 않기 때문)
- 표현 영역이 아닌 도메인 영역이나 응용 영역의 개발을 먼저 시작하면 응용 서비스 클래스가 먼저 만들어지기 떄문에 인터페이스는 필요하지 않다.

### 6.3.4 표현 영역에 의존하지 않기

- 응용 서비스의 파라미터 타입을 결정할 때 주의할 점은 표현 영역과 관련된 타입을 사용하면 안 된다는 점이다.
- 예를 들어, 표현 영역에 해당하는 HttpServletRequest나 HttpSessionn을 응용 서비스에 파라미터로 전달하면 안 된다.
  - 응용 서비스에서 표현 영역에 대한 의존이 발생하면 응용 서비스만 단독으로 테스트하기가 어려워진다.
  - 응용 서비스가 표현 영역의 역할까지 대신하는 상황이 벌어질수도 있다.

# 💡 6.4 표현 영역

- 표현 영역의 책임은 크게 다음과 같다.
  - 사용자가 시스템을 사용할 수 있는 흐름（화면）을 제공하고 제어한다.
  - 사용자의 요청을 알맞은 응용 서비스에 전달하고 결과를 사용자에게 제공한다.
  - 사용자의 세션을 관리한다.
 
# 💡 6.5 값 검증

- 값 검증은 표현 영역과 응용 서비스 두 곳에서 모두 수행할 수 있다.
- 원칙적으로 모든 값에 대한 검증은 응용 서비스에서 처리한다.
- 편의성을 위해 표현 영역에서 필수 값과 값의 형식을 검사하고, 응용 서비스는 ID 중복 여부와 같은 논리적 오류를 검사하도록 할 수 있다.
  - 즉, 표현 영역과 응용 서비스가 값 검사를 나눠서 수행하는 것이다.
  - 표현 영역: 필수 값, 값의 형식, 범위 등을 검증한다.
  - 응용 서비스: 데이터의 존재 유무와 같은 논리적 오류를 검증한다.
- 필자는 위와 같이 편의성을 위해 값의 검증 책임을 나누다가 최근에는 응용 서비스에서 필수 값 검증과 논리적 검증을 모두 하는 편이라고 한다. (응용 서비스의 완성도가 높아진다.)

# 💡 6.6 권한 검사

- 보안 프레임워크(e.g. 스프링 시큐리티)의 복잡도를 떠나 보통 다음 세 곳에서 권한 검사를 수행할 수 있다.
  - 표현 영역 (인증된 사용자인지 검증. 보통은 Filter에서 검증하게 된다.)
  - 응용 서비스 (보통은 인가된 사용자인지 검증. 해당 도메인에 접근 권한이 있는지를 검증)
  - 도메인

# 💡 6.7 조회 전용 기능과 응용 서비스

- 서비스에서 조회 전용 기능을 사용하면 서비스 코드가 단순히 조회 전용 기능을 호출하는 형태로 끝날 수 있다.
- 서비스에서 수행하는 추가적인 로직이 없을뿐더러 단일 쿼리만 실행하는 조회 전용 기능이어서 트랜잭션이 필요하지도 않다.
- 이 경우라면 굳이 서비스를 만들 필요 없이 표현 영역에서 바로 조회 전용 기능을 사용해도 문제가 없다.
