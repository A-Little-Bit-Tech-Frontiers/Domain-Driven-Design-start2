# 6. 응용 서비스와 표현 영역

### 응용 서비스의 역할

응용 서비스는 도메인 객체를 사용해서 사용자의 요청을 처리한다. 즉, **도메인 영역과 표현 영역을 연결**하는 역할을 하는 것이다. 응용 서비스는 도메인 로직을 직접 구현하지 않고 애그리거트를 통해 로직을 처리하게 된다.

### 응용 서비스의 구현

응용 서비스는 표현 영역과 도메인 영역을 연결하기 위해 Facade 패턴과 같은 방법으로 구현하게 된다. 여기서 응용 서비스를 구현하는 방법은 다음과 같다.

- 한 응용 서비스 클래스에 도메인 기능 모두 구현하기
    - 장점 : 동일한 로직을 Private 메서드로 분리하여 중복 제거가 쉽다.
    - 단점 : 기능 별로 필요한 의존성이 한데 섞이게 되어 코드를 이해하기 어려워진다.
- **도메인에서 구분되는 기능 별로 응용 클래스를 분리하여 구현하기**
    - 장점 : 하나의 기능을 위해 꼭 필요한 의존성만 포함하고, 다른 기능의 영향을 받지 않아 기능에 대해 이해가 쉽고, 코드 품질을 높게 유지할 수 있다.
    - 단점 : 기능 별로 클래스를 만들기 때문에 클래스가 많아질 수 있다. 하나의 도메인에 대한 기능들에게 필요한 공통 로직이 있다면 새로운 Helper 클래스로 구현하여 의존성으로 추가해 주어야 한다.

```java
// 공통 로직 헬퍼 클래스
public final class UserServiceHelper {
	public static String generateAccessToken(
		final TokenProvider tokenProvider,
		final UUID userId
	) {
		return tokenProvider.createToken(userId);
	}
}

// 응용 계층 파사드 서비스
@Service
@RequiredArgsConstructor
public class UserRegisterFacadeService {
	private final UserService userService; **// 도메인 서비스**
	private final TokenProvider tokenProvider; // 필수 의존성

	public User register(final String username, final String password) {
		final User user = userService.create(username, password);
		final String accessToken = UserServiceHelper.generateAccessToken(user.getId());
		return user;
	}
}
```

### 응용 서비스의 인터페이스와 클래스

- 응용 서비스의 인터페이스 구현 필요성
    - 응용 서비스는 인터페이스를 통해 다수의 구현체가 생길 일이 거의 없고, 교체할 일 또한 거의 없기 때문에 인터페이스를 구현해서 상속하는 패턴이 큰 장점 없이 생산성에 영향을 미칠 수 있다.
    - 표현 계층을 먼저 구현하기 위해 인터페이스를 미리 구현한다면 분명 장점이 될 수 있다. 컨트롤러를 먼저 구현할 때 인터페이스 의존성만 추가해서 완성할 수 있기 때문이다. 하지만, 응용 서비스를 먼저 구현한다고 할 때 이미 대역 객체에 대한 지원이 좋은 테스트 프레임워크(Mockito 등)를 사용할 수 있다면, 굳이 인터페이스를 사용한 단위 테스트의 필요성이 약화된다.
- 메서드 파라미터와 값 반환
    - 사용자가 요구한 기능에 대한 필요한 파라미터를 받고, 응용 서비스에 전달하는데 데이터 클래스를 사용하면 좋다. 응용 서비스를 실행하기 위한 전처리 및 프레임워크 기능 활용에 유리하기 때문이다.
    - 값 반환을 할 때도 표현 계층에서 필요한 데이터만 별도로 추출해서 내보내는 것이 좋다. 애그리거트를 직접 리턴하게 되면 애그리거트의 기능 또한 함께 노출되어 기능 로직의 응집도가 낮아지기 때문이다.
- 표현 영역에 의존하지 않기
    - Spring 에서 Servlet 관련 기능을 사용할 때 흔히 사용되는 클래스가 HttpServletRequest, HttpServletResponse 등이다. 이와 같은 클래스를 응용 서비스에 전달해서 사용하게 되면, 표현 계층의 일을 응용 서비스에서 대신 수행하게 되어 표현 영역의 상태 추적이 어려워진다. 이를 방지하려면, 응용 서비스에서 표현 영역의 기술을 원천적으로 사용하지 않는 것이 가장 쉬운 방법이다.
- 트랜잭션 처리
    - Spring 에서 응용 서비스에 대한 트랜잭션 처리는 `@Transactional` 을 적용해서 원하는 영역에서 쉽게 처리할 수 있기 때문에, 응용 서비스에서 적극 사용하는 것이 좋다.

### 표현 영역

- 표현 영역의 책임
    - 사용자가 시스템을 사용할 수 있는 화면 또는 흐름(View) 을 제공 및 제어한다.
    - 사용자 요청을 알맞은 응용 서비스에 전달하고 결과를 반환한다.
    - 사용자의 세션을 관리한다.
- **입력 값 검증**
    - 사용자가 입력한 값에 대해 검증하고, 잘못 입력했을 경우 ValidationError 를 반환한다.
    - 사용자에게 좋은 경험을 주기 위해 모든 입력 값을 검증하고, 잘못된 값 각각에 대해 오류를 주어 한번에 알 수 있도록 하는 것이 좋다.
    - 표현 계층은 입력 값 자체에 대한 검증, 응용 서비스는 논리적 검증을 주로 하는 편이다.