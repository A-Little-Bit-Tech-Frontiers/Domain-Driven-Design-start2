# 응용 서비스와 표현 영역

## 표현 영역과 응용 영역

도메인이 제 기능을 하려면 사용자와 도메인을 연결해 주는 매개체가 필요하다. <br>
응용 영역과 표현 영역이 사용자와 도메인을 연결해 주는 매개체 역할을 한다.

<img width="635" alt="Image" src="https://github.com/user-attachments/assets/d43d4914-277b-459b-9c7b-769a0bdb65e2" />

**표현 영역은 사용자의 요청을 해석한다.** <br>
사용자가 웹 브라우저에서 폼에 ID와 암호를 입력한 뒤에 전송 버튼을 클릭하면 요청 파라미터를 포함한 HTTP 요청을 표현 영역에 전달한다. <br>
요청을 받은 표현 영역은 URL, 요청 파라미터, 쿠키, 헤더 등을 이용해서 사용자가 실행하고 싶은 기능을 판별하고 그 기능을 제공하는 응용 서비스를 실행한다.

**실제 사용자가 원하는 기능을 제공하는 것은 응용 영역에 위치한 서비스다.** <br>
사용자가 회원 가입을 요청했다면 실제 그 요청을 위한 기능을 제공하는 주체는 응용 서비스에 위치한다.

## 응용 서비스의 역할

응용 서비스는 ㄴ사용자가 요청한 기능을 실행한다. <br>
응용 서비스의 주요 역할은 도메인 객체를 사용해서 사용자의 요청을 처리하는 것이므로 표현 영역 입장에서 보았을때, 도메인 영역과 표현 영역을 연결해 주는 창구 역할을한다.

```java
public Result doSomeFunc(SomeReq req) {
        // 1. 리포지터리에서 애그리거트를 구한다.
        SomeAgg agg = someAggRepository .findById (req .getId0)；
        checkNuU(agg);

        // 2. 애그리거트의 도메인 기능을 실행한다.
        agg.doFunc(req.getValue());

        // 3. 결과를 리턴한다.
        return createSuccessResult(agg);
}
```

응용 서비스가 복잡하다면 응용 서비스에서 도메인 로직의 일부를 구현하고 있을 가능성이 높다. <br>
응용 서비스가 도메인 로직을 일부 구현하면 중복, 로직 분산 등 코드 품질에 안 좋은 영향을 줄 수 있다. <br>
**응용 서비스는 트랜잭션 처리도 담당한다. 응용 서비스는 도메인의 상태 변경을 트랜잭션으로 처리해야 한다.**

## 응용 서비스의 구현

응용 서비스는 표현 영역과 도메인 영역을 연결하는 매개체 역할을 하는데 이는 디자인 패턴에서 파사드와 같은 역할을 한다. <br>
응용 서비스 자체는 복잡한 로직을 수행하지 않기 때문에 응용 서비스의 구현은 어렵지 않다.

### 응용 서비스의 크기

회원 도메인을 생각해 보자. 응용 서비스는 회원 가입하기, 회원 탈퇴하기, 회원 암호 변경하기, 비밀번호 초기화하기와 같은 기능을 구현하기 위해 도메인 모델을 사용하게 된다. <br>
이 경우 응용 서비스는 보통 다음의 두 가지 방법 중 한 가지 방식으로 구현한다.

- 한 응용 서비스 클래스에 회원 도메인의 모든 기능 구현하기
- 구분되는 기능별로 응용 서비스 클래스를 따로 구현하기

코드 크기가 커지면 연관성이 적은 코드가 한 클래스에 함께 위치할 가능성이 높아지게 되는데 결과적으로 관련 없는 코드가 뒤섞여 코드를 이해하는 데 방해가 된다. <br>
한 클래스에 코드가 모이기 시작하면 엄연히 분리하는 것이 좋은 상황임에도 습관적으로 기존에 존재하는 클래스에 억지로 끼워 넣게 된다. <br>
이것은 코드를 점점 얽히게 만들어 코드 품질을 낮추는 결과를 초래한다.

### 표현 영역에 의존하지 않기

응용 서비스의 파라미터 타입을 결정할 때 주의할 점은 표현 영역과 관련된 타입을 사용하면 안 된다는 점이다. <br>
예를 들어 다음과 같이 표현 영역에 해당하는 HttpServletRequest나 HttpSession을 응용 서비스에 파라미터로 전달하면 안 된다. <br>
응용 서비스에서 표현 영역에 대한 의존이 발생하면 응용 서비스만 단독으로 테스트하기가 어려워진다. <br>
게다가 표현 영역의 구현이 변경되면 응용 서비스의 구현도 함께 변경해야 하는 문제도 발생한다.

```java

@Controller
@RequestMapping("member/changePassword")
public class MemberPasswordControUer {

    @PostMapping
    public String submit(HttpServletRequest request) {
        try {
            // 응용 서비스가 표현 영역을 의존하면 안 됨!
            changePasswordService.changePassword(request);
        } catch (NoMemberException ex) {
            
        }
    }
}
```

## 표현 영역

표현 영역의 책임은 크게 다음과 같다.

- 사용자가 시스템을 사용할 수 있는 흐름을 제공하고 제어한다.
- 사용자의 요청을 알맞은 응용 서비스에 전달하고 결과를 사용자에게 제공한다.
- 사용자의 세션을 관리한다.

## 값 검증

값 검증은 표현 영역과 응용 서비스 두 곳에서 모두 수행할 수 있다. <br>
표현 영역에서 필수 값과 값의 형식을 검사하면 실질적으로 응용 서비스는 ID 중복 여부와 같은 논리적 오류만 검사하면 된다. <br>
즉 표현 영역과 응용 서비스가 값 검사를 나눠서 수행하는 것이다.











